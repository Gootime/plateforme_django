{% extends 'base.html' %} {% block content %} {%load static%}
<link rel="stylesheet" href="../..{%static 'css/star-rating-svg.css'%}" />
<link rel="stylesheet" href="../..{%static 'css/viewTerritoire.css'%}">
<script
		type="text/javascript"
		src="../..{%static 'js/jquery.star-rating-svg.js'%}"
></script>
<script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
<style media="screen">
	/*.grid_filter {*/
		/*border: 1px solid #333;*/
	/*}*/

	/* clear fix */
	.isotope:after {
		content: '';
		display: block;
		/*clear: both;*/
	}

	/* ---- .element-item ---- */

	.element-item {
		position: relative;
		float: left;
		/*width: 100px;*/
		/*height: 100px;*/
		/*margin: 5px;*/
		/*padding: 10px;*/
		/*background: #888;*/
		/*color: #262524;*/
	}

	.element-item > * {
		/*margin: 0;*/
		/*padding: 0;*/
	}

	.element-item .name {
		position: absolute;

		left: 10px;
		top: 60px;
		text-transform: none;
		letter-spacing: 0;
		font-size: 12px;
		font-weight: normal;
	}

	.element-item .symbol {
		position: absolute;
		left: 10px;
		top: 0px;
		font-size: 42px;
		font-weight: bold;
		color: white;
	}

	.element-item .number {
		position: absolute;
		right: 8px;
		top: 5px;
	}

	.element-item .weight {
		position: absolute;
		left: 10px;
		top: 76px;
		font-size: 12px;
	}
	/*fin isotope*/

	.card .territoires{
		border: none;
		background-color: #ee5249 !important;
	}
	.card-img-top{
		background-color: antiquewhite;
	}
	.card-body .territoires{
		background-color: #ee5249;
	}
	.card-title.territoires{
		color: #fff;
		font-family: "Permanent Marker", cursive;
	}

	p.text-right, .fa-thumbs-up{
		color: #cede92 !important;
		font-weight: bold;
	}

	.card-body > p{
		/*line-height: 0.15rem;*/
	}
	.card-body > p:nth-of-type(3){
		font-style: italic;
	}

    h5.card-title{
        min-height: 5vh;
    }

	.btn-success {
		background-color: #cede92 !important;
		border-color: #cede92 !important;
		color: #000;
	}
	.btn-success:hover {
		background-color: #443f2f !important;
		border-color: #443f2f !important;
		color: #fff;
	}

	#video{
		height: 16vh;
		background-color: #443f2f !important;
	}
	img.img-fluid{
		width: 300px;
		height: 19vh;
		background-color: #443f2f !important;
	}

    a#profil{
        color: #cede92 !important;
    }
    a#profil:hover, a#profil:focus{
        text-decoration: none;
    }

	h5:not(.all_territoires){
		height: 7vh;
	}

	.card-body.territoires > p:nth-of-type(3){
		min-height: 4vh;
	}

	@media(max-width: 375px){
		#territoires, #categories{
			font-size: x-small;
		}
		.container-fluid {
			margin-top: 1.5rem;
		}
	}

	.pagination > strong{
		color: #ee5249;
	}

</style>

<div class="jumbotron jumbotron-fluid mb-0">
	<div class="container">
		<h1 class="display-4">Toutes les capsules</h1>
	</div>
</div>
<div class="fil_d_ariane">
	<div class="container" >
		<div class="row">
			<div class="col">
				<p><a href="{% url 'home' %}">Accueil</a> <span> &raquo; Toutes les capsules </span></p>
			</div>
		</div>
	</div>
</div>

<div class="container">
	<div class="container-fluid">
		<div class="row">
			<div class="col">
				{{territoires.0}}
				<div class="form-group">
					<select name="territoires" id="territoires" class="form-control custom-select filter option-set clearfix" data-filter-group="territoire">
						<option value="*" data-filter-value="">Tous les Territoires</option>

						{% for t in territoires %}
								<option value="#{{t.pk.id}}" data-filter-value=".{{t.pk.id}}">{{t.pk.name}}</option>
						{% endfor %}
					</select>
				</div>
			</div>
			<div class="col">
				<div class="form-group">
					<select name="categories" id="categories" class="filter option-set clearfix form-control custom-select"  data-filter-group="categories">
						<option value="*">Tous les médias</option>
						{% for category in categories %}
							{% if category == 1 %}
								<option value="#{{category}}" data-filter-value=".{{category}}">Image</option>
							{% endif %}
							{% if category == 2 %}
								<option value="#{{category}}" data-filter-value=".{{category}}">Vidéo</option>
							{% endif %}
							{% if category == 3 %}
								<option value="#{{category}}" data-filter-value=".{{category}}">Audio</option>
							{% endif %}
							{% if category == 4 %}
								<option value="#{{category}}" data-filter-value=".{{category}}">Récit</option>
							{% endif %}
						{% endfor %}
					</select>
				</div>
			</div>
		</div>

        <!--{{articles}}-->
		<div class="row grid_filter">
			{% for post in articles %}
			<div class="col-lg-4 col-md-6 col-12 mx-auto element-item {{post.pk.category}} {{post.pk.place}}">
				<div class="card territoires mb-4">

					{% if post.pk.category == 2 %}
					<video controls id="video" src="{{post.pk.file}}" class="img-fluid w-100"></video>
					{% else %}
					<img class="img-fluid w-100" src="{{post.pk.file}}" alt="carte" />
					{% endif %}

					<div class="card-body territoires">
						<h5 class="card-title territoires text-center">{{ post.pk.title|truncatechars:75 }}</h5>
						<p>
							{% if post.pk.category == 1 %}
							<span>Image </span>
							{% endif %}
							{% if post.pk.category == 2 %}
							<span>Vidéo </span>
							{% endif %}
							{% if post.pk.category == 3 %}
							<span>Audio </span>
							{% endif %}
							{% if post.pk.category == 4 %}
							<span>Récit </span>
							{% endif %}
							par <a id="profil" href="{% url 'profil_other' post.pk.user %}">{{post.pk.username}}</a></p>

                        <span class="full_date" style="display: none;">{{post.pk.date}}</span>
                        <span class="good_date"></span>

						<p class="card-text">{{ post.pk.content|truncatechars:85 }}</p>

						<p class="text-right">{{post.pk.like}} &nbsp; <i class="fas fa-thumbs-up"></i></p>
						<a href="{% url 'lire' post.pk.id %}" class="btn btn-success btn-block">Lire la suite</a>
					</div>
				</div>
			</div>

			{% empty %}
			<h4>Aucun article.</h4>
			{% endfor %}

		</div>
	</div>
</div>

<div class="container-fluid d-flex justify-content-center">
	<div class="pagination text-center">
		{% if articles.has_previous %}
		<a href="?page=1"> Première Page </a>&nbsp;&nbsp;&nbsp;<a href="?page={{articles.previous_page_number}}"> < </a>

		{% endif %}
		{% for num in articles.paginator.page_range %}
		{% if articles.number == num %}
		<strong>{{ num }}</strong>
		{% elif num > articles.number|add:'-3' and num < articles.number|add:'3' %}
		<a href="?page={{ num }}">&nbsp;{{ num }}&nbsp;</a>
		{% endif %}
		{% endfor %}
		{% if articles.has_next %}
		<a href="?page={{articles.next_page_number}}"> > </a>&nbsp;&nbsp;&nbsp;<a href="?page={{articles.paginator.num_pages}}"> Dernière Page </a>

		{% endif %}
	</div>
</div>

<script type="text/javascript">
    $(function(){

        var $container = $('.grid_filter'),
            filters = {};

        $container.isotope({
            itemSelector : '.element-item'
        });

        // filter buttons
        $('select').change(function(){
            var $this = $(this);

            // store filter value in object
            // i.e. filters.color = 'red'
            var group = $this.attr('data-filter-group');

            filters[ group ] = $this.find(':selected').attr('data-filter-value');
             console.log( $this.find(':selected') )
            // convert object into array
            var isoFilters = [];
            for ( var prop in filters ) {
                isoFilters.push( filters[ prop ] )
            }
						/*if(isoFilters.length > 0){
								$('.pagination').css({display: 'none'})
						}else if($('select').val('*')){
							$('.pagination').css({display: 'block'})
						}else{
							$('.pagination').css({display: 'block'})
						}*/
            var selector = isoFilters.join('');
            $container.isotope({ filter: selector });
            return false;
        });

    });


    //2019-02-05T23:22:01.714652+01:00
    var full_date = $('.full_date').text();
    var short_date = full_date.slice(0,10);
    var array_date = short_date.split('-');
    var m_names = new Array("Jan.", "Fév.", "Mar.", "Avr.", "Mai", "Jui.", "Juil.", "Aoû.", "Sept.", "Oct.", "Nov.", "Déc.");
    var nb_month = array_date[1];
    var month = parseInt(nb_month);
    // console.log(nb_month);
    var month_ok = month-1;
    console.log(m_names[month_ok]);
    var formated_date = array_date[2] + ' ' + m_names[month_ok] + ' ' + array_date[0];
    // console.log(full_date);
    // console.log(short_date);
    // console.log(array_date);
    // console.log(formated_date);

    $('.good_date').replaceWith('<p id=\"good_date\">Le ' + formated_date + '</p>');
</script>

{% endblock %}
